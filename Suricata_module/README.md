


# Модуль ПО Suricata для протокола OPC UA

Модуль предназначен для обнаружения пакетов протокола OPC UA по ключевым словам, которые отвечают за конкретные поля протокола.

## За что отвечают файлы?

1. **app-layer-opcua**
Этот файл отвает за обнаружение запросов и ответов в трафике, для которого используется 4840 порт (OPC UA)

2. **detect-opcua-opcuabuf**  
Этот файл отвечает за:
   -   парсинг правил, определение ключевых слов
   -   обнаружение пакетов соответствующих правилам. 

## Как писать правила?
Поиск возможен по следующим ключевым словам:
- **type** - отвечает за тип сообщения. 

Доступные типы: 
   ```
   HEL | OPN | ACK | MSG
   ```
- **size** - отвечает за длину пакета.  
Есть возможность обнаружить пакеты с меньшей, равной или большей длинной (lt | eq | gt). 
После выбора операции сравнения следует написать длину пакета для сравнения в байтах.
- **token** - отвечает за токен безопасности. Это ключевое слово используется для фиксирования изменений токена безопасности.
- **request** - Отвечает за id запроса. Для обнаружения конкретного запроса после ключевого слова необходимо написать id запроса.
- **function** - отвечает за используемый клиентом сервис (функцию).   
   Доступные типы: 
   - *создание сесии*
   ```
   createSessionReq | createSessionResp
   ```
   - *поиск объекта*
   ```
   browseReq | browseResp
   ```
   - *чтение параметров*
   ```
   readReq | readResp
   ```
**Примеры правил можной найти в файле:**
`opcua.rules`

## Как запустить ПО Suricata?
1. Модифицировать конфигурационный файл `/etc/suricata/suricata.yaml`
   - изменить адрес сети
   - изменить интерфейс, на котором будет анализироваться рафик
   - изменить путь к файлам с правилами для обнаружения пакетов
2. Описать правила обнаружения пакетов в файле с расширением `.rules`, который указан в `suricata.yaml`
3. Запустить ПО с помощью команды:
```
sudo suricata -c /etc/suricata/suricata.yaml -i lo --init-errors-fatal
```
   - **-c** - путь к конфигурационному файлу
   - **-i** - название интерфейса
   - **--init-errors-fatal** - при обнаружении ошибки Suricata завершает работу








